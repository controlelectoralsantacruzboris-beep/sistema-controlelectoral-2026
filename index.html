<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<title>Mapa Electoral 2026</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>
body { margin:0; font-family: Arial; }
#map { height:100vh; }

/* Buscador estilo Google */
.search-box{
position:absolute;
top:15px;
left:50%;
transform:translateX(-50%);
z-index:1000;
width:350px;
}

.search-box input{
width:100%;
padding:10px 15px;
border-radius:25px;
border:1px solid #ccc;
font-size:14px;
outline:none;
box-shadow:0 2px 6px rgba(0,0,0,0.2);
}

.suggestions{
background:white;
max-height:200px;
overflow-y:auto;
border-radius:10px;
margin-top:5px;
box-shadow:0 2px 6px rgba(0,0,0,0.2);
}

.suggestions div{
padding:8px 12px;
cursor:pointer;
}

.suggestions div:hover{
background:#f0f0f0;
}
</style>
</head>
<body>

<div class="search-box">
<input type="text" id="searchInput" placeholder="Buscar recinto...">
<div id="suggestions" class="suggestions"></div>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>

// ===== MAPA =====
var map = L.map('map').setView([-16.5,-68.15], 12);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
maxZoom:19
}).addTo(map);

var capaRecintos = L.layerGroup().addTo(map);
var capaDistritos = L.layerGroup().addTo(map);

var datosRecintos = [];
var markers = [];

// ===== COLORES POR PARTIDO =====
function colorPartido(p){
if(!p) return "gray";
p = p.toUpperCase();

if(p.includes("DEMOCRATAS")) return "green";
if(p.includes("PDC")) return "green";
if(p.includes("MAS-IPSP")) return "blue";
if(p.includes("NULO")) return "blue";
if(p.includes("UNIDAD")) return "yellow";
if(p.includes("LIBER")) return "red";
if(p.includes("UCS")) return "cyan";
if(p.includes("C-A")) return "orange";

return "gray";
}

// ===== CARGAR RECINTOS =====
fetch("recintos2026.json")
.then(r=>r.json())
.then(data=>{

datosRecintos = data;

let maxHab = Math.max(...data.map(d=>Number(d.Habilitados2026)||0));
if(maxHab===0) maxHab=1;

data.forEach(d=>{

let lat = Number(d.Latitud);
let lng = Number(d.Longitud);

if(isNaN(lat) || isNaN(lng)) return;

let size = (Number(d.Habilitados2026)||0)/maxHab * 25;

let marker = L.circleMarker([lat,lng],{
radius: 4 + size,
fillColor:"#007bff",
color:"#000",
weight:1,
fillOpacity:0.8
}).addTo(capaRecintos);

marker.bindPopup(`
<b>üè´ ${d.Recinto}</b><br><br>
üë§ <b>Jefe:</b> ${d.JefesdeRecinto || "N/D"}<br>
üó≥ <b>Habilitados:</b> ${d.Habilitados2026 || 0}
`);

markers.push({
nombre:d.Recinto,
marker:marker
});

});

});

// ===== BUSCADOR PREDICTIVO =====
var input = document.getElementById("searchInput");
var suggestions = document.getElementById("suggestions");

input.addEventListener("input",function(){

let texto = this.value.toLowerCase();
suggestions.innerHTML="";

if(texto.length<2) return;

let filtrados = markers.filter(m=>m.nombre.toLowerCase().includes(texto));

filtrados.slice(0,8).forEach(m=>{

let div = document.createElement("div");
div.innerText = m.nombre;

div.onclick = function(){
map.setView(m.marker.getLatLng(),16);
m.marker.openPopup();
suggestions.innerHTML="";
input.value="";
};

suggestions.appendChild(div);

});

});

// ===== CARGAR DISTRITOS (WKT SIMPLE) =====
fetch("csvjsondistritos.json")
.then(r=>r.json())
.then(data=>{

data.forEach(d=>{

if(!d.WKT) return;

try{

let limpio = d.WKT
.replace("MULTIPOLYGON(((","")
.replace("POLYGON((","")
.replace(")))","")
.replace("))","");

let coords = limpio.split(",");

let latlngs = [];

coords.forEach(c=>{
let p = c.trim().split(/\s+/);
if(p.length>=2){
latlngs.push([parseFloat(p[1]),parseFloat(p[0])]);
}
});

if(latlngs.length>2){

L.polygon(latlngs,{
color:"#555",
weight:1,
fillColor:"#ff0000",
fillOpacity:0.15
}).addTo(capaDistritos);

}

}catch(e){}

});

capaDistritos.bringToBack();

});

</script>

</body>
</html>